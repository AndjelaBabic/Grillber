{% extends "template.html" %} {% block content %} {% block page-style %}
{% endblock %}
<div class="main">
	<h1>Order history</h1>
	<div class="w3_agile_main_grids">
		<div id='progress'></div>

		<div class="agile_form">
			<h3>My orders</h3>
			<table id="orders">
				<tr>
					<th>Number</th>
					<th>BBQ</th>
					<th>Delivery date</th>
					<th>Delivery time</th>
					<th>Address</th>
					<th>Edit</th>
					<th>Delete</th>
				</tr>
				{% for order in orders %}
				<tr id="id{{forloop.counter}}">	
					<td>{{forloop.counter}}</td>
					<td class="bbq">{{order.bbq}}</td>
					<td class="delivery-date">{{order.delivery_time}}</td>
					<td>17:00</td>
					<td class="main-address">{{order.addressid}}</td>
					<td>
						<button class="edit mybtn">
							<i class="fa fa-edit" aria-hidden="true"></i>
						</button>
					</td>
					<td>
						<button class="remove mybtn">
							<i class="fa fa-remove" aria-hidden="true"></i>
						</button>
					</td>
				</tr>
				{% endfor %}
			</table>
		</div>

		<!-- The Modal -->
		<div id="myModal" class="modal">
			<!-- Modal content -->
			<div class="modal-content">
				<span class="close">&times;</span>
				<form action="#" class="agile_form" method="post">
					<h3>Edit</h3>
					<fieldset>

						<div class="form-group agileits_w3layouts_form "
							style="padding-top: 20px">BBQ:</div>
						<div class="form-group agileits_w3layouts_form">
							<div class="wthree_input">
								<i class="fa fa-globe" aria-hidden="true"></i> <select
									id="bbq-select" class="form-control">
									<option value="BBQ" selected="">BBQ</option>
									<option value="SIGNET 90">SIGNET 90</option>
									<option value="REGAL S590">REGAL S590</option>
									<option value="IMPERIAL XLS">IMPERIAL XLS</option>
								</select>
							</div>
						</div>

						<div class="form-group agileits_w3layouts_form "
							style="padding-top: 20px">Delivery date:</div>
						<div class="form-group agileits_w3layouts_form">
							<div class="wthree_input">
								<i class="fa fa-calendar" aria-hidden="true"></i> <input
									id="date-modal" type="date" name="Delivery"
									class="form-control dateclass" placeholder="Pick a date" />
							</div>
						</div>

						<div class="form-group agileits_w3layouts_form"
							style="padding-top: 20px">Address:</div>
						<div class="form-group agileits_w3layouts_form ">
							<div class="wthree_input">
								<i class="fa fa-home" aria-hidden="true"></i> <input
									id="Address" type="text" name="Address" class="form-control" />
							</div>
						</div>

						<input id="rowId" type="hidden" />
						<div>
							<h3>
								<button id="SaveChanges" class="btn btn-primary"
									style="margin-top: 20px">Save changes</button>
							</h3>
						</div>
					</fieldset>
				</form>
			</div>
		</div>

	</div>
</div>

{% endblock %} {% block page-scripts %}
<script>
	$(".remove").on('click', function(event) {
		//alert($(this).closest('tr')[0].sectionRowIndex);
		$(this).closest('tr').remove();
	});

	$(".edit").on('click', function(event) {
		var rowId = $(this).closest('tr')[0].sectionRowIndex;
		var modal = document.getElementById("myModal");
		var mainAddress = $(this).closest('tr').find('.main-address').text();
		var bbq = $(this).closest('tr').find('.bbq').text();
		var date = $(this).closest('tr').find('.delivery-date').text();
		$('#Address').val(mainAddress);
		$('#rowId').val(rowId);
		$("#bbq-select").val(bbq);
		$("#date-modal").val(date);
		modal.style.display = "block";

	});

	$("#SaveChanges").on('click', function(event) {
		var address = $('#Address').val();
		var bbq = $('#bbq-select').val();
		var rowId = $('#rowId').val();
		updateFields(address, bbq, rowId);
	});

	function updateFields(address, bbq, rowId) {
		//alert($('#id1').find("td").eq(1).text());
		$('#id1').find("td").eq(1).html("aa");
		//alert($('#id1').find("td").eq(1).text());
		var myTable = $('#orders').DataTable();
		myTable.clear().rows.add(myTable.data).draw();
	}

	var modal = document.getElementById("myModal");
	// Get the <span> element that closes the modal
	var span = document.getElementsByClassName("close")[0];
	// When the user clicks on <span> (x), close the modal
	span.onclick = function() {
		modal.style.display = "none";
	}

	// When the user clicks anywhere outside of the modal, close it
	window.onclick = function(event) {
		if (event.target == modal) {
			modal.style.display = "none";
		}
	}
</script>
{% endblock %}
